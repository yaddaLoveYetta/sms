<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="UTF-8">

</head>

<body onload="ReWritable();">
<table id="tbmain" style="width:100%;" border="1">
    <tr>
        <td>11
        </td>
        <td>12
        </td>
        <td>13
        </td>
    </tr>
    <tr>
        <td>21
        </td>
        <td>22
        </td>
        <td>23
        </td>
    </tr>
    <tr>
        <td>31
        </td>
        <td>32
        </td>
        <td>33
        </td>
    </tr>
</table>
<script>

    /*
     页面装载时，为每个td增加单击事件，这样，就可以不用对每个页面进行更改。
     */
    function ReWritable() {
        var tbmian = document.getElementById("tbmain");
        for (var i = 0; i < tbmain.rows.length; i++) {
            for (var j = 0; j < tbmain.rows[i].cells.length; j++) {
                /*
                 添加单击事件属性。此处不可使用setAttribute方法。
                 */
                tbmain.rows[i].cells[j].onclick = AddObjOfText;
            }
        }
    }
    /*
     单击事件，将Td内容更新为一个Div，其中装载了一个Text，用于用户输入新的Td的值，
     一个确定按钮，一个取消按钮，用于保存或取消用户的输入内容。
     一个Hidden，保存用户输入新值前的Td的值，以便用户取消时恢复。
     */
    function AddObjOfText() {
        var tdcag = document.getElementById("tdcag");
        if (tdcag != null) {
            return;
        }
        var tdid = window.event.srcElement;
        var tdtxt = tdid.innerText;
        var str = "<div id='tdcag'><input type='text' id='txtId' value='" + tdtxt + "'>";
        str += "<input type='button' value='确定' onclick='ChangeTdText()'>";
        str += "<input type='button' value='取消' onclick='CancelTdChanged()'>";
        str += "<input type='hidden' id='tdInitValue' value='" + tdtxt + "'>";
        str += "</div>";
        tdid.innerHTML = str;
    }
    /*
     取消更改，把Hidden值赋给Td
     */
    function CancelTdChanged() {
        var tdInitValue = document.getElementById("tdInitValue");
        var tdtxt = tdInitValue.value;
        var tdid = document.getElementById("tdcag").parentNode;
        tdid.innerText = tdtxt;
    }
    /*
     保存用户更改，把Text值赋值给Td
     */
    function ChangeTdText() {
        var txtId = document.getElementById("txtId");
        var tdid = document.getElementById("tdcag").parentNode;
        tdid.innerText = txtId.value;
    }
</script>
</body>
</html>